class Solution {
     private int solve(int i, int j1, int j2, int n, int m, int[][] grid, int[][][] dp) {
        if(j1 < 0 || j1 > m-1 || j2 < 0 || j2 > m-1) {
            return (int)-1e8;
        }

        if(i == n-1) {
            if(j1 == j2) {
                return grid[i][j1];
            }
            else {
                return grid[i][j1] + grid[i][j2];
            }
        }

        if(dp[i][j1][j2] != -1) {
            return dp[i][j1][j2];
        }

        int maxi = (int)-1e9;
        for(int k = -1; k<=1; k++) {
            for(int l = -1; l<=1; l++) {
                if(j1 == j2) {
                    maxi = Math.max(maxi, grid[i][j1] + solve(i+1, j1+k, j2+l, n, m, grid, dp));
                }
                else {
                    maxi = Math.max(maxi, grid[i][j1]+grid[i][j2] + solve(i+1, j1+k, j2+l, n, m, grid, dp));
                }
            }
        }
        return dp[i][j1][j2] = maxi;
    }

    public int cherryPickup(int[][] grid) {
        int n = grid.length;
        int m = grid[0].length;

        int[][][] dp = new int[n][m][m];
        for(int[][] i : dp) {
            for(int[] j: i) {
                Arrays.fill(j, -1);
            }
        }

        return solve(0, 0, m-1, n, m, grid, dp);
    }
}
